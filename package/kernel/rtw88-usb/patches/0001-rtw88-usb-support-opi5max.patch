From d883811d5f1a03efe4ee7e58369f55c7c87c71e6 Mon Sep 17 00:00:00 2001
From: yml <ymlgdut@gmail.com>
Date: Wed, 10 Jul 2024 20:10:24 +0800
Subject: [PATCH] rtw88-usb support opi5max

---
 Makefile | 24 +++++++-----------------
 main.c   |  3 ++-
 2 files changed, 9 insertions(+), 18 deletions(-)

diff --git a/Makefile b/Makefile
index badfe33..f2e3cc4 100644
--- a/Makefile
+++ b/Makefile
@@ -87,9 +87,6 @@ rtw_8822cu-objs		:= rtw8822cu.o
 obj-m	   += rtw_8723x.o
 rtw_8723x-objs		:= rtw8723x.o
 
-obj-m	   += rtw_8703b.o
-rtw_8703b-objs		:= rtw8703b.o rtw8703b_tables.o
-
 obj-m	   += rtw_8723x.o
 rtw_8723x-objs		:= rtw8723x.o
 
@@ -99,12 +96,6 @@ rtw_8822cs-objs		:= rtw8822cs.o
 obj-m			+= rtw_8723x.o
 rtw_8723x-objs	:= rtw8723x.o
 
-obj-m	    += rtw_8723cs.o
-rtw_8723cs-objs		:= rtw8723cs.o
-
-obj-m	    += rtw_8723cs.o
-rtw_8723cs-objs		:= rtw8723cs.o
-
 obj-m       += rtw_8723d.o
 rtw_8723d-objs          := rtw8723d.o rtw8723d_table.o
 
@@ -113,8 +104,8 @@ obj-m      += rtw_8723de.o
 rtw_8723de-objs               := rtw8723de.o
 endif
 
-obj-m      += rtw_8723du.o
-rtw_8723du-objs		:= rtw8723du.o
+obj-m      += rtw88_8723du.o
+rtw88_8723du-objs		:= rtw8723du.o
 
 obj-m      += rtw_8723ds.o
 rtw_8723ds-objs		:= rtw8723ds.o
@@ -144,8 +135,8 @@ rtw_8812au-objs		:= rtw8812au.o
 obj-m	   += rtw_8821cs.o
 rtw_8821cs-objs		:= rtw8821cs.o
 
-obj-m	+= rtw_8821cu.o
-rtw_8821cu-objs		:= rtw8821cu.o
+obj-m	+= rtw88_8821cu.o
+rtw88_8821cu-objs		:= rtw8821cu.o
 
 ifeq ($(CONFIG_PCI), y)
 obj-m			+= rtw_pci.o
@@ -158,8 +149,8 @@ rtw_sdio-objs		:= sdio.o
 obj-m			+= rtw_usb.o
 rtw_usb-objs		:= usb.o
 
-obj-m         += rtw_usb.o
-rtw_usb-objs                := usb.o
+obj-m         += rtw88_usb.o
+rtw88_usb-objs                := usb.o
 
 ccflags-y += -D__CHECK_ENDIAN__
 
@@ -273,5 +264,4 @@ endif
 	@$(KSRC)/scripts/sign-file sha256 MOK.priv MOK.der rtw_8723x.ko
 	@$(KSRC)/scripts/sign-file sha256 MOK.priv MOK.der rtw_8723cs.ko
 
-sign-install: all sign install
-
+sign-install: all sign install
\ No newline at end of file
diff --git a/main.c b/main.c
index f85ee8d..c54227d 100644
--- a/main.c
+++ b/main.c
@@ -219,6 +219,7 @@ static void rtw_watch_dog_work(struct work_struct *work)
 	struct rtw_watch_dog_iter_data data = {};
 	bool busy_traffic = test_bit(RTW_FLAG_BUSY_TRAFFIC, rtwdev->flags);
 	bool ps_active;
+	int received_beacons;
 
 	mutex_lock(&rtwdev->mutex);
 
@@ -258,7 +259,7 @@ static void rtw_watch_dog_work(struct work_struct *work)
 	if (test_bit(RTW_FLAG_SCANNING, rtwdev->flags))
 		goto unlock;
 
-	int received_beacons = rtwdev->dm_info.cur_pkt_count.num_bcn_pkt;
+	received_beacons = rtwdev->dm_info.cur_pkt_count.num_bcn_pkt;
 
 	/* make sure BB/RF is working for dynamic mech */
 	rtw_leave_lps(rtwdev);
-- 
2.34.1

